---
name: tdd-workflow
description: テスト駆動開発（TDD）のワークフローガイド。Red-Green-Refactorサイクルに従い、品質の高いコードを効率的に開発する。
model: sonnet-4-5
---

# TDD ワークフロー

## 適用タイミング

新機能の実装、バグ修正、リファクタリング時にこのワークフローを適用する。

## 基本サイクル: Red → Green → Refactor

### 1. Red: 失敗するテストを書く

```typescript
// まずユーザーストーリーを定義
// 「ユーザーとして、カートに商品を追加できる」

describe("カートに商品を追加", () => {
  it("商品を追加するとカート内の商品数が増える", () => {
    const cart = new Cart();
    cart.add({ id: "1", name: "商品A", price: 1000 });
    expect(cart.items).toHaveLength(1);
  });

  it("同じ商品を追加すると数量が増える", () => {
    const cart = new Cart();
    cart.add({ id: "1", name: "商品A", price: 1000 });
    cart.add({ id: "1", name: "商品A", price: 1000 });
    expect(cart.items[0].quantity).toBe(2);
  });
});
```

### 2. Green: テストを通す最小限のコードを書く

- テストを通すことだけに集中
- 設計の美しさは後回し
- ハードコードでも可

### 3. Refactor: コードを改善する

- テストが通る状態を維持
- 重複を排除
- 命名を改善
- パフォーマンスを最適化

## テスト種別と割合

| 種別 | 割合 | 対象 | ツール |
|------|------|------|--------|
| ユニット | 70% | 関数、コンポーネント、フック | Vitest |
| 統合 | 20% | API、サービス間連携 | Vitest + MSW |
| E2E | 10% | 重要なユーザーフロー | Playwright |

## テスト設計の原則

1. **ユーザー視点でテスト**: 実装の詳細ではなく振る舞いをテスト
2. **1テスト1アサーション**: 可能な限り1つの検証に絞る
3. **テストの独立性**: 他のテストに依存しない
4. **意味のある名前**: `it("正しく動作する")` ではなく `it("空のカートに商品を追加すると商品数が1になる")`

## カバレッジ目標

- 全体: 80%以上
- ビジネスロジック: 90%以上
- UIコンポーネント: 70%以上

## アンチパターン

- テスト後にコードを書く（TDDではない）
- 実装の詳細をテストする（`useState`の値を直接検証等）
- テストデータを外部ファイルに定義する（テスト内に書く）
- 過剰なモック（本物を使えるなら使う）
